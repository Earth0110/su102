<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Safe Space for Her ‚Äì SDGs 5</title>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f6c1d1 0%, #c7b7ff 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .chat-container {
      width: 100%;
      max-width: 420px;
      background: rgba(255,255,255,0.96);
      border-radius: 24px;
      box-shadow: 0 25px 60px rgba(0,0,0,0.25);
      overflow: hidden;
      animation: slideUp .5s ease;
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .chat-header {
      background: linear-gradient(135deg, #f3a4c7 0%, #b9a6ff 100%);
      color: #fff;
      padding: 24px 20px;
      text-align: center;
    }

    .chat-header h3 {
      font-size: 22px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .chat-header p {
      font-size: 14px;
      opacity: .95;
    }

    .chat-body { padding: 20px; }

    label {
      display: block;
      font-size: 14px;
      color: #666;
      margin-bottom: 8px;
      font-weight: 500;
    }

    input[type="text"] {
      width: 100%;
      padding: 14px 16px;
      border-radius: 14px;
      border: 2px solid #e6e6e6;
      font-size: 15px;
      outline: none;
      transition: .25s;
    }

    input[type="text"]:focus {
      border-color: #d89cff;
      box-shadow: 0 0 0 4px rgba(216,156,255,0.15);
    }

    #messages {
      height: 360px;
      overflow-y: auto;
      background: #faf7fb;
      border-radius: 16px;
      padding: 14px;
      margin: 15px 0;
    }

    .msg {
      background: #fff;
      padding: 12px 14px;
      border-radius: 14px;
      margin-bottom: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      animation: fadeIn .25s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .name {
      color: #c06be0;
      font-weight: 600;
      font-size: 13px;
      margin-bottom: 4px;
      display: block;
    }

    .text {
      color: #333;
      font-size: 15px;
      line-height: 1.45;
    }

    .message-input-section {
      display: flex;
      gap: 10px;
    }

    button {
      background: linear-gradient(135deg, #f3a4c7 0%, #b9a6ff 100%);
      color: #fff;
      border: none;
      padding: 14px 22px;
      border-radius: 14px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 6px 18px rgba(185,166,255,0.45);
      transition: .25s;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 22px rgba(185,166,255,0.55);
    }

    .empty-state {
      text-align: center;
      color: #aaa;
      padding: 40px 10px;
    }

    .empty-state span {
      font-size: 44px;
      display: block;
      margin-bottom: 8px;
    }

    @media (max-width: 500px) {
      .chat-container { border-radius: 0; }
      #messages { height: 320px; }
    }
  </style>
</head>
<body>

<div class="chat-container">
  <div class="chat-header">
    <h3>üíó Safe Space</h3>
    <p>‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á</p>
  </div>

  <div class="chat-body">
    <label>üë§ ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</label>
    <input type="text" id="nicknameInput" placeholder="‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô (‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡∏ï‡∏ô)" maxlength="20">

    <div id="messages">
      <div class="empty-state">
        <span>üí¨</span>
        <p>‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢<br>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏¥‡∏°‡∏û‡πå‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</p>
      </div>
    </div>

    <div class="message-input-section">
      <input type="text" id="messageInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..." />
      <button onclick="sendMessage()">‡∏™‡πà‡∏á</button>
    </div>
  </div>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAU9hjYfn0sdAt0IXCTZ6CRbSV4TR6w5kY",
    authDomain: "su102-2cf53.firebaseapp.com",
    projectId: "su102-2cf53"
  };

  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.firestore();
  const messageRef = db.collection("messages");

  let userId = "";

  auth.signInAnonymously().then(r => userId = r.user.uid);

  messageRef.orderBy("timestamp").onSnapshot(snapshot => {
    const box = document.getElementById("messages");
    box.innerHTML = "";

    if (snapshot.empty) {
      box.innerHTML = `
        <div class="empty-state">
          <span>üí¨</span>
          <p>‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢<br>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏¥‡∏°‡∏û‡πå‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</p>
        </div>`;
      return;
    }

    snapshot.forEach(doc => {
      const d = doc.data();
      const div = document.createElement("div");
      div.className = "msg";
      div.innerHTML = `<span class='name'>${d.nickname || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠'}</span><div class='text'>${escapeHtml(d.text)}</div>`;
      box.appendChild(div);
    });
    box.scrollTop = box.scrollHeight;
  });

  function sendMessage() {
    const text = messageInput.value.trim();
    const nick = nicknameInput.value.trim();

    if (!nick) {
      alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏Å‡πà‡∏≠‡∏ô");
      nicknameInput.focus();
      return;
    }

    if (!text) return;

    messageRef.add({
      text,
      nickname: nick,
      userId,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });

    messageInput.value = "";
    messageInput.focus();
  }

  messageInput.addEventListener("keypress", e => {
    if (e.key === "Enter") sendMessage();
  });

  function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }
</script>

</body>
</html>